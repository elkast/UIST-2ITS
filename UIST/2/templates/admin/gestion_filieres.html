{% extends "base.html" %}

{% block titre %}Gestion des Filières - UIST-2ITS{% endblock %}

{% block contenu %}
<div class="mb-6 lg:mb-8">
    <h2 class="text-2xl lg:text-3xl font-bold text-gray-800">Gestion des Filières</h2>
    <p class="text-sm lg:text-base text-gray-600 mt-2">Ajouter, modifier ou supprimer des filières</p>
</div>

<!-- Formulaire d'ajout -->
<div class="bg-white rounded-lg shadow-md p-4 lg:p-6 mb-6 lg:mb-8">
    <h3 class="text-lg lg:text-xl font-bold text-gray-800 mb-4">Ajouter une Nouvelle Filière</h3>
    <form method="POST" action="{{ url_for('admin.ajouter_filiere') }}" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4">
        <div>
            <label for="nom_filiere" class="block text-xs lg:text-sm font-medium text-gray-700 mb-2">Nom de la Filière *</label>
            <input type="text" id="nom_filiere" name="nom_filiere" required class="w-full px-3 lg:px-4 py-2 text-sm lg:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none" placeholder="Ex: Informatique">
        </div>
        <div>
            <label for="niveau" class="block text-xs lg:text-sm font-medium text-gray-700 mb-2">Niveau *</label>
            <select id="niveau" name="niveau" required class="w-full px-3 lg:px-4 py-2 text-sm lg:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none">
                <option value="">Sélectionner...</option>
                <option value="L1">L1</option>
                <option value="L2">L2</option>
                <option value="L3">L3</option>
                <option value="M1">M1</option>
                <option value="M2">M2</option>
            </select>
        </div>
        <div>
            <label for="nombre_etudiants" class="block text-xs lg:text-sm font-medium text-gray-700 mb-2">Nombre d'Étudiants</label>
            <input type="number" id="nombre_etudiants" name="nombre_etudiants" min="0" value="0" class="w-full px-3 lg:px-4 py-2 text-sm lg:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none" placeholder="0">
        </div>
        <div class="flex items-end sm:col-span-2 lg:col-span-1">
            <button type="submit" class="w-full bg-uist-bleu hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition text-sm lg:text-base">
                Ajouter
            </button>
        </div>
    </form>
</div>

<!-- Liste des filières -->
<div class="bg-white rounded-lg shadow-md overflow-hidden">
    <div class="px-4 lg:px-6 py-3 lg:py-4 bg-gray-50 border-b border-gray-200">
        <h3 class="text-lg lg:text-xl font-bold text-gray-800">Liste des Filières ({{ filieres|length if filieres else 0 }})</h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-sm lg:text-base">
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Nom</th>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Niveau</th>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider hidden sm:table-cell">Étudiants</th>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% if filieres %}
                    {% for filiere in filieres %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-3 lg:px-6 py-3 lg:py-4 whitespace-nowrap font-semibold text-gray-800">{{ filiere.nom_filiere }}</td>
                        <td class="px-3 lg:px-6 py-3 lg:py-4 whitespace-nowrap">
                            <span class="px-2 lg:px-3 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">{{ filiere.niveau }}</span>
                        </td>
                        <td class="px-3 lg:px-6 py-3 lg:py-4 whitespace-nowrap text-gray-600 hidden sm:table-cell">{{ filiere.nombre_etudiants }}</td>
                        <td class="px-3 lg:px-6 py-3 lg:py-4 whitespace-nowrap text-right text-xs lg:text-sm">
                            <button onclick="modifierFiliere({{ filiere.id }}, '{{ filiere.nom_filiere }}', '{{ filiere.niveau }}', {{ filiere.nombre_etudiants }})" class="text-blue-600 hover:text-blue-800 mr-2 lg:mr-3">Modifier</button>
                            <form method="POST" action="{{ url_for('admin.supprimer_filiere', filiere_id=filiere.id) }}" class="inline" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette filière ?');">
                                <button type="submit" class="text-red-600 hover:text-red-800">Supprimer</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="4" class="px-3 lg:px-6 py-6 lg:py-8 text-center text-gray-500 text-sm lg:text-base">Aucune filière enregistrée</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal de modification -->
<div id="modalModification" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full mx-4">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Modifier la Filière</h3>
        <form id="formModification" method="POST" class="space-y-4">
            <div>
                <label for="mod_nom_filiere" class="block text-sm font-medium text-gray-700 mb-2">Nom de la Filière *</label>
                <input type="text" id="mod_nom_filiere" name="nom_filiere" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none">
            </div>
            <div>
                <label for="mod_niveau" class="block text-sm font-medium text-gray-700 mb-2">Niveau *</label>
                <select id="mod_niveau" name="niveau" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none">
                    <option value="L1">L1</option>
                    <option value="L2">L2</option>
                    <option value="L3">L3</option>
                    <option value="M1">M1</option>
                    <option value="M2">M2</option>
                </select>
            </div>
            <div>
                <label for="mod_nombre_etudiants" class="block text-sm font-medium text-gray-700 mb-2">Nombre d'Étudiants</label>
                <input type="number" id="mod_nombre_etudiants" name="nombre_etudiants" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none">
            </div>
            <div class="flex space-x-4">
                <button type="submit" class="flex-1 bg-uist-bleu hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition">
                    Enregistrer
                </button>
                <button type="button" onclick="fermerModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 rounded-lg transition">
                    Annuler
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function modifierFiliere(id, nom, niveau, nombre) {
    document.getElementById('formModification').action = '/admin/filieres/modifier/' + id;
    document.getElementById('mod_nom_filiere').value = nom;
    document.getElementById('mod_niveau').value = niveau;
    document.getElementById('mod_nombre_etudiants').value = nombre;
    document.getElementById('modalModification').classList.remove('hidden');
}

function fermerModal() {
    document.getElementById('modalModification').classList.add('hidden');
}
</script>
{% endblock %}