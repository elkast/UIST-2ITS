{% extends "base.html" %}

{% block titre %}Gestion des Salles - UIST-2ITS{% endblock %}

{% block contenu %}
<div class="mb-8">
    <h2 class="text-3xl font-bold text-gray-800">Gestion des Salles</h2>
    <p class="text-gray-600 mt-2">Ajouter, modifier ou supprimer des salles</p>
</div>

<!-- Formulaire d'ajout -->
<div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <h3 class="text-xl font-bold text-gray-800 mb-4">Ajouter une Nouvelle Salle</h3>
    <form method="POST" action="{{ url_for('admin.ajouter_salle') }}" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
            <label for="nom_salle" class="block text-sm font-medium text-gray-700 mb-2">Nom de la Salle *</label>
            <input type="text" id="nom_salle" name="nom_salle" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none" placeholder="Ex: Amphi A">
        </div>
        <div>
            <label for="capacite" class="block text-sm font-medium text-gray-700 mb-2">Capacité *</label>
            <input type="number" id="capacite" name="capacite" required min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none" placeholder="50">
        </div>
        <div>
            <label for="equipements" class="block text-sm font-medium text-gray-700 mb-2">Équipements</label>
            <input type="text" id="equipements" name="equipements" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none" placeholder="Vidéo-projecteur, PC">
        </div>
        <div class="flex items-end">
            <button type="submit" class="w-full bg-uist-bleu hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition">
                Ajouter
            </button>
        </div>
    </form>
</div>

<!-- Liste des salles -->
<div class="bg-white rounded-lg shadow-md overflow-hidden">
    <div class="px-6 py-4 bg-gray-50 border-b border-gray-200">
        <h3 class="text-xl font-bold text-gray-800">Liste des Salles ({{ salles|length if salles else 0 }})</h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Nom</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Capacité</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">Équipements</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase tracking-wider">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% if salles %}
                    {% for salle in salles %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap font-semibold text-gray-800">{{ salle.nom_salle }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-gray-600">{{ salle.capacite }} places</td>
                        <td class="px-6 py-4 text-gray-600">{{ salle.equipements or 'Aucun' }}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm">
                            <button onclick="modifierSalle({{ salle.id }}, '{{ salle.nom_salle }}', {{ salle.capacite }}, '{{ salle.equipements or '' }}')" class="text-blue-600 hover:text-blue-800 mr-3">Modifier</button>
                            <form method="POST" action="{{ url_for('admin.supprimer_salle', salle_id=salle.id) }}" class="inline" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette salle ?');">
                                <button type="submit" class="text-red-600 hover:text-red-800">Supprimer</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="4" class="px-6 py-8 text-center text-gray-500">Aucune salle enregistrée</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal de modification (caché par défaut) -->
<div id="modalModification" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full mx-4">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Modifier la Salle</h3>
        <form id="formModification" method="POST" class="space-y-4">
            <div>
                <label for="mod_nom_salle" class="block text-sm font-medium text-gray-700 mb-2">Nom de la Salle *</label>
                <input type="text" id="mod_nom_salle" name="nom_salle" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none">
            </div>
            <div>
                <label for="mod_capacite" class="block text-sm font-medium text-gray-700 mb-2">Capacité *</label>
                <input type="number" id="mod_capacite" name="capacite" required min="1" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none">
            </div>
            <div>
                <label for="mod_equipements" class="block text-sm font-medium text-gray-700 mb-2">Équipements</label>
                <input type="text" id="mod_equipements" name="equipements" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu focus:border-transparent outline-none">
            </div>
            <div class="flex space-x-4">
                <button type="submit" class="flex-1 bg-uist-bleu hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition">
                    Enregistrer
                </button>
                <button type="button" onclick="fermerModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 rounded-lg transition">
                    Annuler
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function modifierSalle(id, nom, capacite, equipements) {
    document.getElementById('formModification').action = '/admin/salles/modifier/' + id;
    document.getElementById('mod_nom_salle').value = nom;
    document.getElementById('mod_capacite').value = capacite;
    document.getElementById('mod_equipements').value = equipements;
    document.getElementById('modalModification').classList.remove('hidden');
}

function fermerModal() {
    document.getElementById('modalModification').classList.add('hidden');
}
</script>
{% endblock %}