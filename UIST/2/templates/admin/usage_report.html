{% extends "base.html" %}

{% block title %}Rapport d'Usage - UIST-2ITS{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">
                        <i class="fas fa-chart-bar"></i> Rapport d'Usage du Système
                    </h3>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('admin.generer_rapport_usage_web') }}" method="post">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="format">Format:</label>
                                    <select class="form-control" id="format" name="format" required>
                                        <option value="json">JSON</option>
                                        <option value="csv">CSV</option>
                                        <option value="pdf">PDF</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="start">Date début:</label>
                                    <input type="date" class="form-control" id="start" name="start">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="end">Date fin:</label>
                                    <input type="date" class="form-control" id="end" name="end">
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label>&nbsp;</label><br>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-chart-bar"></i> Générer Rapport
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>

                    {% if report_data %}
                    <hr>
                    <div class="alert alert-success">
                        <h5>Rapport généré avec succès!</h5>
                        {% if report_url %}
                        <p><a href="{{ report_url }}" target="_blank" class="btn btn-success">
                            <i class="fas fa-download"></i> Télécharger le Rapport
                        </a></p>
                        {% else %}
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Statistiques Générales</h6>
                                <ul class="list-group">
                                    <li class="list-group-item">Utilisateurs actifs: <strong>{{ report_data.active_users }}</strong></li>
                                    <li class="list-group-item">Bulletins générés: <strong>{{ report_data.bulletins_generated }}</strong></li>
                                    <li class="list-group-item">Imports de notes: <strong>{{ report_data.notes_imports }}</strong></li>
                                    <li class="list-group-item">Actions d'audit: <strong>{{ report_data.audit_actions|length }}</strong></li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Utilisateurs par Rôle</h6>
                                <ul class="list-group">
                                    {% for stat in report_data.users_by_role %}
                                    <li class="list-group-item">{{ stat.role }}: <strong>{{ stat.count }}</strong></li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
