{% extends "base.html" %}
{% block titre %}Gestion des Cours - UIST-2ITS{% endblock %}
{% block contenu %}
<div class="mb-8">
    <h2 class="text-3xl font-bold text-gray-800">Gestion des Cours</h2>
    <p class="text-gray-600 mt-2">Ajouter, modifier ou supprimer des cours et assigner des enseignants</p>
</div>

<!-- Ajouter un cours -->
<div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <h3 class="text-xl font-bold text-gray-800 mb-4">Ajouter un Nouveau Cours</h3>
    <form method="POST" action="{{ url_for('admin.ajouter_cours') }}" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Nom du Cours *</label>
            <input type="text" name="nom_cours" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ex: Algorithmique">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Filière *</label>
            <select name="filiere_id" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                <option value="">Sélectionner...</option>
                {% for f in filieres %}
                <option value="{{ f.id }}">{{ f.nom_filiere }} ({{ f.niveau }})</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Type *</label>
            <select name="type_cours" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                <option value="">Sélectionner...</option>
                <option value="CM">CM</option>
                <option value="TD">TD</option>
                <option value="TP">TP</option>
            </select>
        </div>
        <div class="flex items-end">
            <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition">Ajouter</button>
        </div>
    </form>
</div>

<!-- Liste des cours -->
<div class="bg-white rounded-lg shadow-md overflow-hidden">
    <div class="px-6 py-4 bg-gray-50 border-b">
        <h3 class="text-xl font-bold text-gray-800">Liste des Cours ({{ cours|length if cours else 0 }})</h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase">Nom</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase">Filière</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase">Type</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-700 uppercase">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% if cours %}
                {% for c in cours %}
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 font-semibold text-gray-800">{{ c.nom_cours }}</td>
                    <td class="px-6 py-4 text-gray-600">{{ c.nom_filiere }} ({{ c.niveau }})</td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 text-xs font-semibold rounded-full {% if c.type_cours == 'CM' %}bg-purple-100 text-purple-800{% elif c.type_cours == 'TD' %}bg-green-100 text-green-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                            {{ c.type_cours }}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-right text-sm space-x-2">
                        <button onclick="assignerEnseignant({{ c.id }}, '{{ c.nom_cours }}')" class="text-green-600 hover:text-green-800">Assigner</button>
                        <button onclick="modifierCours({{ c.id }},'{{ c.nom_cours }}',{{ c.filiere_id }},'{{ c.type_cours }}')" class="text-blue-600 hover:text-blue-800">Modifier</button>
                        <form method="POST" action="{{ url_for('admin.supprimer_cours', cours_id=c.id) }}" class="inline" onsubmit="return confirm('Supprimer ce cours ?');">
                            <button type="submit" class="text-red-600 hover:text-red-800">Supprimer</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="4" class="px-6 py-8 text-center text-gray-500">Aucun cours enregistré</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal Modification Cours -->
<div id="modalModification" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full mx-4">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Modifier le Cours</h3>
        <form id="formModification" method="POST" class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Nom *</label>
                <input type="text" id="mod_nom_cours" name="nom_cours" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Filière *</label>
                <select id="mod_filiere_id" name="filiere_id" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    {% for f in filieres %}
                    <option value="{{ f.id }}">{{ f.nom_filiere }} ({{ f.niveau }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Type *</label>
                <select id="mod_type_cours" name="type_cours" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    <option value="CM">CM</option>
                    <option value="TD">TD</option>
                    <option value="TP">TP</option>
                </select>
            </div>
            <div class="flex space-x-4">
                <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition">Enregistrer</button>
                <button type="button" onclick="fermerModal('modalModification')" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 rounded-lg transition">Annuler</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Assigner Enseignant -->
<div id="modalAssigner" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full mx-4">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Assigner un Enseignant</h3>
        <p class="text-gray-600 mb-4">Cours: <span id="assign_cours_nom" class="font-semibold"></span></p>
        <form id="formAssigner" method="POST" class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Enseignant *</label>
                    <select name="enseignant_id" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        <option value="">Sélectionner...</option>
                        {% if enseignants %}
                        {% for e in enseignants %}
                        <option value="{{ e.id }}">{{ e.prenom }} {{ e.nom }}{% if e.specialite %} ({{ e.specialite }}){% endif %}</option>
                        {% endfor %}
                        {% endif %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Salle *</label>
                    <select name="salle_id" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        <option value="">Sélectionner...</option>
                        {% if salles %}
                        {% for s in salles %}
                        <option value="{{ s.id }}">{{ s.nom_salle }} (Cap: {{ s.capacite }})</option>
                        {% endfor %}
                        {% endif %}
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Jour *</label>
                    <select name="jour" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        <option value="">Sélectionner...</option>
                        <option value="Lundi">Lundi</option>
                        <option value="Mardi">Mardi</option>
                        <option value="Mercredi">Mercredi</option>
                        <option value="Jeudi">Jeudi</option>
                        <option value="Vendredi">Vendredi</option>
                        <option value="Samedi">Samedi</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Heure Début *</label>
                    <input type="time" name="heure_debut" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Heure Fin *</label>
                    <input type="time" name="heure_fin" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
            </div>
            <div class="flex space-x-4 mt-6">
                <button type="submit" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 rounded-lg transition">Assigner</button>
                <button type="button" onclick="fermerModal('modalAssigner')" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 rounded-lg transition">Annuler</button>
            </div>
        </form>
    </div>
</div>

<script>
function modifierCours(id, nom, fil, type) {
    document.getElementById('formModification').action = '/admin/cours/modifier/' + id;
    document.getElementById('mod_nom_cours').value = nom;
    document.getElementById('mod_filiere_id').value = fil;
    document.getElementById('mod_type_cours').value = type;
    document.getElementById('modalModification').classList.remove('hidden');
}

function assignerEnseignant(coursId, coursNom) {
    document.getElementById('formAssigner').action = '/admin/cours/assigner-enseignant/' + coursId;
    document.getElementById('assign_cours_nom').textContent = coursNom;
    document.getElementById('modalAssigner').classList.remove('hidden');
}

function fermerModal(modalId) {
    document.getElementById(modalId).classList.add('hidden');
}
</script>
{% endblock %}