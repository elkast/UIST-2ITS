{% extends "base.html" %}
{% block titre %}Gestion des Créneaux - UIST-2ITS{% endblock %}
{% block contenu %}
<div class="mb-6 lg:mb-8">
    <h2 class="text-2xl lg:text-3xl font-bold text-gray-800">Gestion des Créneaux d'Emploi du Temps</h2>
    <p class="text-sm lg:text-base text-gray-600 mt-2">Créer et organiser l'emploi du temps</p>
</div>

<div class="bg-white rounded-lg shadow-md p-4 lg:p-6 mb-6 lg:mb-8">
    <h3 class="text-lg lg:text-xl font-bold text-gray-800 mb-4">Ajouter un Nouveau Créneau</h3>
    <form method="POST" action="{{ url_for('admin.ajouter_creneau') }}" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 lg:gap-4">
        <div>
            <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-2">Cours *</label>
            <select name="cours_id" required class="w-full px-3 lg:px-4 py-2 text-sm lg:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
                <option value="">Sélectionner...</option>
                {% for c in cours %}
                <option value="{{ c.id }}">{{ c.nom_cours }} ({{ c.type_cours }})</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-2">Enseignant *</label>
            <select name="enseignant_id" required class="w-full px-3 lg:px-4 py-2 text-sm lg:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
                <option value="">Sélectionner...</option>
                {% for e in enseignants %}
                <option value="{{ e.id }}">{{ e.prenom }} {{ e.nom }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-2">Salle *</label>
            <select name="salle_id" required class="w-full px-3 lg:px-4 py-2 text-sm lg:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
                <option value="">Sélectionner...</option>
                {% for s in salles %}
                <option value="{{ s.id }}">{{ s.nom_salle }} ({{ s.capacite }} pl.)</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-2">Jour *</label>
            <select name="jour" required class="w-full px-3 lg:px-4 py-2 text-sm lg:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
                <option value="">Sélectionner...</option>
                <option value="Lundi">Lundi</option>
                <option value="Mardi">Mardi</option>
                <option value="Mercredi">Mercredi</option>
                <option value="Jeudi">Jeudi</option>
                <option value="Vendredi">Vendredi</option>
                <option value="Samedi">Samedi</option>
            </select>
        </div>
        <div>
            <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-2">Heure Début *</label>
            <input type="time" name="heure_debut" required class="w-full px-3 lg:px-4 py-2 text-sm lg:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
        </div>
        <div>
            <label class="block text-xs lg:text-sm font-medium text-gray-700 mb-2">Heure Fin *</label>
            <input type="time" name="heure_fin" required class="w-full px-3 lg:px-4 py-2 text-sm lg:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
        </div>
        <div class="sm:col-span-2 lg:col-span-3">
            <button type="submit" class="w-full bg-uist-bleu hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition text-sm lg:text-base">Ajouter le Créneau</button>
        </div>
    </form>
</div>

<div class="bg-white rounded-lg shadow-md overflow-hidden">
    <div class="px-4 lg:px-6 py-3 lg:py-4 bg-gray-50 border-b">
        <h3 class="text-lg lg:text-xl font-bold text-gray-800">Liste des Créneaux ({{ creneaux|length if creneaux else 0 }})</h3>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-sm lg:text-base">
            <thead class="bg-gray-100">
                <tr>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-left text-xs font-medium text-gray-700 uppercase">Jour</th>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-left text-xs font-medium text-gray-700 uppercase">Horaire</th>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-left text-xs font-medium text-gray-700 uppercase">Cours</th>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-left text-xs font-medium text-gray-700 uppercase hidden md:table-cell">Enseignant</th>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-left text-xs font-medium text-gray-700 uppercase hidden lg:table-cell">Salle</th>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-left text-xs font-medium text-gray-700 uppercase hidden xl:table-cell">Filière</th>
                    <th class="px-3 lg:px-6 py-2 lg:py-3 text-right text-xs font-medium text-gray-700 uppercase">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% if creneaux %}
                {% for cr in creneaux %}
                <tr class="hover:bg-gray-50">
                    <td class="px-3 lg:px-6 py-3 lg:py-4 font-semibold text-gray-800">{{ cr.jour }}</td>
                    <td class="px-3 lg:px-6 py-3 lg:py-4 text-gray-600 whitespace-nowrap">{{ cr.heure_debut|format_time }} - {{ cr.heure_fin|format_time }}</td>
                    <td class="px-3 lg:px-6 py-3 lg:py-4 text-gray-800">{{ cr.nom_cours }} <span class="text-xs text-gray-500">({{ cr.type_cours }})</span></td>
                    <td class="px-3 lg:px-6 py-3 lg:py-4 text-gray-600 hidden md:table-cell">{{ cr.enseignant_prenom }} {{ cr.enseignant_nom }}</td>
                    <td class="px-3 lg:px-6 py-3 lg:py-4 text-gray-600 hidden lg:table-cell">{{ cr.nom_salle }}</td>
                    <td class="px-3 lg:px-6 py-3 lg:py-4 text-gray-600 hidden xl:table-cell">{{ cr.nom_filiere }} {{ cr.niveau }}</td>
                    <td class="px-3 lg:px-6 py-3 lg:py-4 text-right text-xs lg:text-sm">
                        <button onclick="modifierCreneau({{ cr.id }},{{ cr.cours_id }},{{ cr.enseignant_id }},{{ cr.salle_id }},'{{ cr.jour }}','{{ cr.heure_debut|format_time }}','{{ cr.heure_fin|format_time }}')" class="text-blue-600 hover:text-blue-800 mr-2 lg:mr-3">Modifier</button>
                        <form method="POST" action="{{ url_for('admin.supprimer_creneau', creneau_id=cr.id) }}" class="inline" onsubmit="return confirm('Supprimer ce créneau ?');">
                            <button type="submit" class="text-red-600 hover:text-red-800">Supprimer</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="7" class="px-3 lg:px-6 py-6 lg:py-8 text-center text-gray-500 text-sm lg:text-base">Aucun créneau enregistré</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal de modification -->
<div id="modalModification" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full mx-4">
        <h3 class="text-2xl font-bold text-gray-800 mb-4">Modifier le Créneau</h3>
        <form id="formModification" method="POST" class="grid grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Cours *</label>
                <select id="mod_cours_id" name="cours_id" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
                    {% for c in cours %}
                    <option value="{{ c.id }}">{{ c.nom_cours }} ({{ c.type_cours }})</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Enseignant *</label>
                <select id="mod_enseignant_id" name="enseignant_id" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
                    {% for e in enseignants %}
                    <option value="{{ e.id }}">{{ e.prenom }} {{ e.nom }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Salle *</label>
                <select id="mod_salle_id" name="salle_id" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
                    {% for s in salles %}
                    <option value="{{ s.id }}">{{ s.nom_salle }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Jour *</label>
                <select id="mod_jour" name="jour" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
                    <option value="Lundi">Lundi</option>
                    <option value="Mardi">Mardi</option>
                    <option value="Mercredi">Mercredi</option>
                    <option value="Jeudi">Jeudi</option>
                    <option value="Vendredi">Vendredi</option>
                    <option value="Samedi">Samedi</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Heure Début *</label>
                <input type="time" id="mod_heure_debut" name="heure_debut" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Heure Fin *</label>
                <input type="time" id="mod_heure_fin" name="heure_fin" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-uist-bleu outline-none">
            </div>
            <div class="col-span-2 flex space-x-4">
                <button type="submit" class="flex-1 bg-uist-bleu hover:bg-blue-600 text-white font-semibold py-2 rounded-lg transition">Enregistrer</button>
                <button type="button" onclick="fermerModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 rounded-lg transition">Annuler</button>
            </div>
        </form>
    </div>
</div>

<script>
function modifierCreneau(id, cid, eid, sid, j, hd, hf) {
    document.getElementById('formModification').action = '/admin/creneaux/modifier/' + id;
    document.getElementById('mod_cours_id').value = cid;
    document.getElementById('mod_enseignant_id').value = eid;
    document.getElementById('mod_salle_id').value = sid;
    document.getElementById('mod_jour').value = j;
    document.getElementById('mod_heure_debut').value = hd;
    document.getElementById('mod_heure_fin').value = hf;
    document.getElementById('modalModification').classList.remove('hidden');
}

function fermerModal() {
    document.getElementById('modalModification').classList.add('hidden');
}
</script>
{% endblock %}
